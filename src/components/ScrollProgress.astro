---
// Scroll Progress Indicator Component
// Shows reading progress at the top of the page with smooth animations
---

<!-- Scroll Progress Bar -->
<div
  id="scroll-progress-container"
  class="scroll-progress fixed top-0 left-0 w-full h-1 bg-base-200/50 backdrop-blur-sm z-50 opacity-0 transition-opacity duration-300"
  style="height: 4px;"
>
  <div
    id="progress-bar"
    class="h-full bg-gradient-to-r from-primary via-secondary to-accent transition-all duration-150 ease-out relative overflow-hidden"
    style="width: 0%"
  >
    <!-- Animated shine effect -->
    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent animate-pulse"></div>
  </div>

  <!-- Glow effect -->
  <div
    id="progress-glow"
    class="absolute top-0 h-full w-8 bg-gradient-to-r from-primary/50 to-transparent transition-all duration-150 ease-out opacity-0 blur-sm"
    style="left: 0%;"
  ></div>
</div>

<style>
  /* Enhanced progress bar styling */
  .scroll-progress {
    transition: opacity 0.3s ease, transform 0.3s ease;
  }

  /* Shine animation */
  @keyframes shine {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(200%); }
  }

  .animate-shine {
    animation: shine 2s infinite;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .scroll-progress {
      height: 3px !important;
    }
  }

  @media (max-width: 320px) {
    .scroll-progress {
      height: 2px !important;
    }
  }

  /* Smooth color transitions for theme changes */
  .scroll-progress {
    transition:
      opacity 0.3s ease,
      background-color 0.3s ease;
  }

  #progress-bar {
    transition:
      width 0.15s ease-out,
      background 0.3s ease;
  }
</style>

<script>
  // Enhanced scroll progress tracking with smart visibility
  let lastScrollTop = 0;
  let isScrolling = false;
  let scrollTimeout;

  function updateScrollProgress() {
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    const scrollHeight = document.documentElement.scrollHeight - window.innerHeight;
    const scrollProgress = (scrollTop / scrollHeight) * 100;

    const progressBar = document.getElementById('progress-bar');
    const progressContainer = document.getElementById('scroll-progress-container');
    const progressGlow = document.getElementById('progress-glow');

    if (progressBar) {
      progressBar.style.width = `${Math.min(scrollProgress, 100)}%`;
    }

    // Update glow effect position
    if (progressGlow) {
      progressGlow.style.left = `${Math.min(scrollProgress, 100)}%`;
      progressGlow.style.opacity = scrollProgress > 0 ? '1' : '0';
    }

    // Show/hide progress bar based on scroll position
    if (progressContainer) {
      if (scrollTop > 100) {
        progressContainer.style.opacity = '1';
      } else {
        progressContainer.style.opacity = '0';
      }
    }

    lastScrollTop = scrollTop;
  }

  // Throttled scroll handler for better performance
  function throttledUpdateScrollProgress() {
    if (!isScrolling) {
      window.requestAnimationFrame(() => {
        updateScrollProgress();
        isScrolling = false;
      });
      isScrolling = true;
    }

    // Clear existing timeout
    clearTimeout(scrollTimeout);
    scrollTimeout = setTimeout(() => {
      isScrolling = false;
    }, 100);
  }

  // Initialize scroll progress tracking
  document.addEventListener('DOMContentLoaded', () => {
    // Update progress on scroll (throttled for performance)
    window.addEventListener('scroll', throttledUpdateScrollProgress, { passive: true });

    // Update progress on resize
    window.addEventListener('resize', updateScrollProgress, { passive: true });

    // Update progress on orientation change (mobile)
    window.addEventListener('orientationchange', () => {
      setTimeout(updateScrollProgress, 100);
    });

    // Initial update
    updateScrollProgress();

    // Also update after images load (affects scroll height)
    const images = document.querySelectorAll('img');
    if (images.length > 0) {
      Promise.all(Array.from(images).map(img => {
        if (img.complete) return Promise.resolve();
        return new Promise(resolve => {
          img.addEventListener('load', resolve);
          img.addEventListener('error', resolve); // Handle broken images
        });
      })).then(updateScrollProgress);
    }
  });

  // Also update progress when content loads dynamically
  window.addEventListener('load', updateScrollProgress);

  // Handle theme changes for smooth transitions
  const observer = new MutationObserver(() => {
    // Re-apply styles when theme changes
    const progressBar = document.getElementById('progress-bar');
    if (progressBar) {
      progressBar.style.transition = 'width 0.15s ease-out, background 0.3s ease';
    }
  });

  // Start observing theme attribute changes
  observer.observe(document.documentElement, {
    attributes: true,
    attributeFilter: ['data-theme', 'class']
  });
</script>